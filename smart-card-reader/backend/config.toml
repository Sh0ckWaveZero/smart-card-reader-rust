# Thai Smart Card Reader Configuration
# ===================================
# This file configures all aspects of the smart card reader application.
# Modify values below to customize behavior without recompiling.

[server]
# WebSocket server binding address
# ⚠️ WARNING: Use "127.0.0.1" for localhost only (RECOMMENDED)
# Using "0.0.0.0" exposes server to external networks - SECURITY RISK!
host = "127.0.0.1"
port = 8182

# CORS Configuration
# ⚠️ SECURITY: Set cors_allow_all = false in production!
cors_allow_all = true

# Allowed CORS origins (used when cors_allow_all = false)
# ⚠️ SECURITY: For production, use environment variable instead:
#   export ALLOWED_ORIGINS="https://app.com,https://www.app.com"
# Config file values are used if env var not set (useful for development)
allowed_origins = [
    "http://localhost:3000",
    "https://localhost:3000",
    # "https://your-production-app.com",
]

# TLS/SSL Configuration for secure WebSocket (wss://)
# ⚠️ PRODUCTION: Enable TLS for secure communication over public networks
enable_tls = false
# Path to TLS certificate file (PEM format)
tls_cert_path = "certs/cert.pem"
# Path to TLS private key file (PEM format)
tls_key_path = "certs/key.pem"

[output]
format = "standard"

# Include base64-encoded photo in output
include_photo = true

# Fields to include in output (empty = all fields)
enabled_fields = []

# Field name mapping (internal -> output key)
[output.field_mapping]
Citizenid     = "Citizenid"
Th_Prefix     = "Th_Prefix"
Th_Firstname  = "Th_Firstname"
Th_Middlename = "Th_Middlename"
Th_Lastname   = "Th_Lastname"
En_Firstname  = "En_Firstname"
En_Lastname   = "En_Lastname"
En_Prefix     = "En_Prefix"
full_name_en  = "full_name_en"
Birthday      = "Birthday"
Sex           = "Sex"
Issuer        = "Issuer"
Issue         = "Issue"
Expire        = "Expire"
Address       = "Address"
addrHouseNo   = "addrHouseNo"
addrVillageNo = "addrVillageNo"
addrRoad      = "addrRoad"
addrLane      = "addrLane"
addrTambol    = "addrTambol"
addrAmphur    = "addrAmphur"
addrProvince  = "addrProvince"
PhotoRaw      = "PhotoRaw"
Nationality   = "Nationality"

[ui]
# Application window settings
window_title = "Thai Smart Card Reader"
window_width = 1100.0
window_height = 750.0
min_width = 1100.0
min_height = 750.0
max_width = 1100.0
max_height = 750.0

[fonts]
# Custom font paths (checked first before system fonts)
# Add paths to Thai-supporting fonts here
# custom_paths = ["/path/to/NotoSansThai-Regular.ttf"]
custom_paths = []

# Search system fonts if custom fonts not found
use_system_fonts = true

[logging]
# Log level: "trace" | "debug" | "info" | "warn" | "error"
level = "info"

[security]
# WebSocket Authentication
# Enable API key authentication for WebSocket connections
enable_authentication = false

# API keys for authentication (comma-separated in env var)
# ⚠️ SECURITY: NEVER commit real API keys to version control!
# For production, use environment variable instead:
#   export API_KEYS="key1-secret-here,key2-secret-here"
# Config file values are used if env var not set (useful for development with dummy keys)
api_keys = []

# API key header name (clients must send this header)
api_key_header = "X-API-Key"

# PII Data Encryption
# Enable AES-256-GCM encryption for sensitive PII data before transmission
enable_encryption = false

# List of field names to encrypt (empty = encrypt all fields)
# ⚠️ SECURITY: Encryption key MUST be set via environment variable:
#   export ENCRYPTION_KEY=$(openssl rand -base64 32)
# Recommended sensitive fields for encryption:
encrypted_fields = [
    "Citizenid",
    "Th_Firstname",
    "Th_Lastname",
    "full_name_en",
    "Address",
]

# Rate Limiting
# Prevent abuse and ensure fair resource allocation
enable_rate_limiting = false

# Maximum requests per time window (per IP address)
rate_limit_requests = 60

# Time window in seconds for rate limiting
rate_limit_window_secs = 60

# Maximum concurrent connections per IP address
rate_limit_max_connections = 5

# Audit Logging
# Record security events for compliance and forensics
enable_audit_logging = false

[card]
# SELECT APDU for Thai ID applet (hex string)
select_apdu = "00A4040008A000000054480001"

# Connection retry settings
retry_attempts = 5
retry_delay_ms = 1000
card_settle_delay_ms = 1000

# Field APDU commands
# Each field has: name, apdu (hex), required (optional, default true)
[[card.fields]]
name = "citizen_id"
apdu = "80B0000402000D"
required = true

[[card.fields]]
name = "full_name_th"
apdu = "80B00011020064"
required = true

[[card.fields]]
name = "full_name_en"
apdu = "80B00075020064"
required = true

[[card.fields]]
name = "date_of_birth"
apdu = "80B000D9020008"
required = true

[[card.fields]]
name = "gender"
apdu = "80B000E1020001"
required = true

[[card.fields]]
name = "issuer"
apdu = "80B000F6020064"
required = false

[[card.fields]]
name = "issue"
apdu = "80B00167020008"
required = true

[[card.fields]]
name = "expire"
apdu = "80B0016F020008"
required = true

[[card.fields]]
name = "address"
apdu = "80B015790200FF"
required = false

# Photo chunk APDU commands (20 chunks for Thai ID photo)
photo_chunks = [
    "80B0017B0200FF",
    "80B0027A0200FF",
    "80B003790200FF",
    "80B004780200FF",
    "80B005770200FF",
    "80B006760200FF",
    "80B007750200FF",
    "80B008740200FF",
    "80B009730200FF",
    "80B00A720200FF",
    "80B00B710200FF",
    "80B00C700200FF",
    "80B00D6F0200FF",
    "80B00E6E0200FF",
    "80B00F6D0200FF",
    "80B0106C0200FF",
    "80B0116B0200FF",
    "80B0126A0200FF",
    "80B013690200FF",
    "80B014680200FF",
]
